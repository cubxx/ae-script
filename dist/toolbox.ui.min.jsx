// Cubx https://github.com/Cubxx/ae-script 2024/7/30 12:42:47
(function(){var r=Array.prototype;var e=Object.prototype;var n=e.hasOwnProperty;var t=r.concat;var o=r.slice;var a=e.toString;var u=9007199254740991;var i=/\w*$/;var c=/^(?:0|[1-9]\d*)$/;function f(r,e){return null!=r&&n.call(r,e)}function l(r){if(null==r)return!1;var e=typeof r;return"object"===e||"function"===e}function p(r,e){var n=Object(r);if(l(e))for(var t in e)if(f(e,t))n[t]=e[t];return n}function s(r,e){var n=-1;var t=r.length;for(;++n<t;)if(r[n]===e)return!0;return!1}function v(r){if(null==r)return void 0===r?"[object Undefined]":"[object Null]";else return a.call(r)}function d(r){return"[object Array]"==v(r)}function y(){var r=-1;var e=arguments.length;for(;++r<e;)if(arguments[r])return!0;return!1}function g(){return!1}function m(r,e){var n=-1;var t=null==r?0:r.length;var o=new Array(t);for(;++n<t;)o[n]=e(r[n],n,r);return o}function h(r,e){return!!(e=null==e?u:e)&&y("number"===typeof r,c.test(r))&&r>-1&&r%1==0&&r<e}function _(r,e){var n=d(r);var t=!n&&function(r){return function(r){return"object"==typeof r&&null!==r}(r)&&"[object Arguments]"==v(r)}(r);var o=n||t;var a=r.length;var u=new Array(o?a:0);var i=o?-1:a;for(;++i<a;)u[i]="".concat(i);for(var c in r)if(f(r,c)&&(!o||"length"!==c&&!h(c,a)))u.push(c);return u}function b(r){return null!=r&&"function"!=typeof r&&function(r){return"number"==typeof r&&r>-1&&r%1==0&&r<=u}(r.length)}function w(r,e){var n=-1;var t=0;var o=null==r?0:r.length;var a=[];for(;++n<o;){var u=r[n];if(e(u,n,r))a[t++]=u}return a}var x="[object Arguments]";var j="[object Boolean]";var A="[object Date]";var k="[object Number]";var E="[object Object]";var S="[object RegExp]";var P="[object String]";var L={};L[x]=L["[object Array]"]=L[j]=L[A]=L[k]=L[E]=L[S]=L[P]=!0;L["[object Error]"]=!1;function B(r,e){var n=r.constructor;switch(e){case j:case A:return new n(r.valueOf());case k:case P:return new n(r);case S:return function(r){var e=i.exec(r.toString());var n=null===e?void 0:e.toString();var t=new(0,r.constructor)(r.source,n);t.lastIndex=r.lastIndex;return t}(r)}}function I(r){var e=r.length;var n=new(0,r.constructor)(e);if(e&&function(r){return"string"==typeof r[0]&&f(r,"index")}(r)){n.index=r.index;n.input=r.input}return n}function G(r,e,n,t,o,a,u){var i;if(void 0!==i)return i;if(!l(r))return r;var c=d(r);var p=v(r);if(c)return function(r,e){var n=-1;var t=r.length;e||(e=new Array(t));for(;++n<t;)e[n]=r[n];return e}(r,i=I(r));else{var s="function"==typeof r;if(y(p==E,p==x,s&&!o)){i=s?{}:function(r){var e=r.constructor;return"function"==typeof e&&e instanceof e?new e:{}}(r);return function(r,e,n){n||(n={});var t=-1,o=e.length;for(;++t<o;){var a=e[t];n[a]=r[a]}return n}(r,function(r){if(null==r)return[];if(b(r))return _(r);var e=[];for(var n in r)if(f(r,n))e.push(n);return e}(r),i)}else return L[p]?B(r,p):o?r:{}}}function V(r,e){var n=-1;var t=r.length;for(;++n<t&&!1!==e(r[n],n,r););return r}function D(r){return r!=r}function C(r,e){return!!(null==r?0:r.length)&&function(r,e,n){return e==e?function(r,e,n){var t=n-1;var o=r.length;for(;++t<o;)if(r[t]===e)return t;return-1}(r,e,n):function(r,e,n,t){var o=r.length;var a=n+-1;for(;++a<o;)if(e(r[a],a,r))return a;return-1}(r,D,n)}(r,e,0)>-1}function N(r,e){var n=-1;var t=r.length;for(;++n<t;)if(e(r[n],n,r))return!0;return!1}function R(r,e){for(var n in r)if(f(r,n))if(!1===e(r[n],n,r))break;return r}function U(r){return null==r}function T(r){return null!=r&&r.length?function(r,e,n){var t=-1;var o=C;var a=[];var u=a;var i=r.length;u=a;r:for(;++t<i;){var c=r[t];var f=c;c=0!==c?c:0;if(f==f){var l=u.length;for(;l--;)if(u[l]===f)continue r;a.push(c)}else if(!o(u,f)){if(u!==a)u.push(f);a.push(c)}}return a}(r):[]}function O(r){return function(e){return null!=e&&e instanceof r}}var M=O(Panel);var W=O(Window);var z=this;var F=$.global;var K={version:"beta 1.0.0",parse:function(r){e=[Window,Panel,Group],V(e,(function(r){var e=r.prototype;e.getElementById=br;e.getElementsByName=xr;e.getElementsByType=jr;_r(e,"getElementById");_r(e,"getElementsByName");_r(e,"getElementsByType")}));var e;var n=l(r)?r:{};var t=dr.apply(null,function(r,e){var n=p((t=J,G(t)),function(r){return cr(r,"config")}(r));var t;var o=Boolean(n.show);var a=Boolean(n.dockable);var u=Boolean(n.singleton);var i=function(r,e,n){if(n||!e)return Window;if(Er(z))return z;return Er(r)?r:Window}(e.context,a,u);var c=function(r,e){if(s(Q,e))return e;if(s(Q,r))return r;return 0}(e.layoutMode,n.layoutMode);return[u,r,i,o,c]}(n,K));K.windows.push(t);return t},windows:[]};var Q=[0,1,2];var H=["dialog","palette","window"];var J={dockable:!0,show:!0,singleton:!1};var q={button:3,checkbox:3,dropdownlist:3,edittext:3,iconbutton:3,image:3,listbox:3,progressbar:4,radiobutton:3,scrollbar:5,slider:5,statictext:3,treeview:3};var X={group:2,panel:3,tab:3,tabbedpanel:3};var Y={button:"A",checkbox:"B",dialog:"C",dropdownlist:"D",edittext:"E",group:"G",iconbutton:"H",image:"I",item:"J",listbox:"K",node:"L",palette:"M",panel:"N",progressbar:"O",radiobutton:"P",scrollbar:"Q",slider:"R",statictext:"S",tab:"T",tabbedpanel:"U",treeview:"V",window:"W"};var Z=/[CGMNTW][ABDEFGHIKNOPQRSUV]|[DK]J|[VL][LJ]|UT/;var rr=gr(/[DGKLNTUV]/),er=gr(/[DKLV]/),nr=gr(/[GNTU]/),tr=gr(/[ABDEHIKOPQRSV]/),or=gr(/[DKUV]/);function ar(r,e,n,t){return"node"==n?function(r,e,n,t){var o=wr(e);var a=function(r,e){return r.add("node",e)}(r,Ar(e));if(o.expanded)t.nodeItems.push(a);delete o["expanded"];p(a,o);return a}(r,e,0,t):function(r,e,n,t){var o=wr(e);var a=function(r,e,n){return r.add(e,n[1],n[2],n[3])}(r,n,ir(e,n));if(or(n)&&f(o,"selection")){var u={container:a,itemIndex:o.selection};t.selectableElement.push(u);delete o["selection"];return p(a,o)}p(a,o);return a}(r,e,n,t)}function ur(r,e,n,t){var o=er(r.type)?function(r,e,n,t){return o=r,a=Ar(e),o.add("item",a);var o,a}(r,e):function(r,e,n,t){return function(r,e,n){return r.add(e,n[1],n[2],n[3],n[4],n[5])}(r,n,ir(e,n))}(r,e,n);p(o,wr(e))}function ir(r,e){return function(r,e){var n=r[0];if(U(n))return r;var t=function(r){if(tr(r))return q[r];if(nr(r))return X[r];return 0}(e);var o=r[t];if(!l(o))r[t]={};if(f(o,"name"))return r;r[t].name=n;return r}(function(r){return d(r)?Sr(r):lr(r)}(r),e)}function cr(r,e){return U(r)?void 0:r[e]}function fr(r){var e=r.properties;return e&&e.name}function lr(r){var e=cr(r,"param");return d(e)?Sr(e):[]}function pr(r){var e=cr(r,"style");return l(e)?e:{}}function sr(r,e,n,t){var o=yr(r,e);kr(o,t);if(W(o)&&n)o.show();return o}function vr(r,e,n,t){var o;return function(){if(function(r){return U(r)||!r.visible}(o))o=yr(r,e);kr(o,t);if(W(o)&&n)o.show();return o}}function dr(r){return(r?vr:sr).apply(null,o.call(arguments,1))}function yr(r,e){var n=function(r,e){var n=function(r,e){return M(e)?e:new Window(r[0],r[1],r[2],r[3])}(function(r){var e=String(r[0]);r[0]=s(H,e)?e:["palette"];return r}(lr(r)),e);n.onResizing=n.onResize=function(){this.layout.resize()};p(n,pr(r));return n}(r,e);var t={nodeItems:[],selectableElement:[]};Pr(r,n,t);V(t.selectableElement,(function(r){var e=r.container;var n=r.itemIndex;if("tabbedpanel"==e.type)e.selection=n;else e.selection=m(function(r){return d(r)?r:[r]}(n),(function(r){return e.items[r]}))}));V(t.nodeItems,(function(r){r.expanded=!0}));return n}function gr(r){return function(e){if(f(Y,e))return r.test(Y[e]);else return!1}}function mr(r,e,n,t){return N(r,(function(r){var o=[];return N(r.children,(function(r){if(nr(r.type))o.push(r);if(t(r))e.push(r);return n(e)}))?!0:mr(o,e,n,t)}))}function hr(r){return T(m(t.apply([],r),String))}function _r(r,e){r.watch(e,(function(r,e){return e}))}function br(r){var e=String(r);var n=[];mr([this],n,(function(r){return r.length>0}),(function(r){var n=fr(r);if(U(n))return!1;else return e===n}));return 0===n.length?null:n[0]}function wr(r){return d(r)?{}:pr(r)}function xr(){var r=hr(arguments);var e=[];var n=[];mr([this],n,(function(){return r.length===e.length}),(function(n){var t=fr(n);if(U(t))return!1;if(s(r,t)&&!s(e,t)){e.push(t);return!0}return!1}));return 0===n.length?null:n}function jr(){var r=hr(arguments);var e=[];mr([this],e,g,(function(e){return s(r,e.type)}));return 0===e.length?null:e}function Ar(r){var e=l(r)?function(r){return cr(r,"param")}(r):r;return String(e)}function kr(r,e){r.layout.layout(e);r.layout.resize()}function Er(r){return r===F||M(r)}function Sr(r){return m(r,(function(r){return function(r){return null===r}(r)?void 0:r}))}function Pr(r,e,n){R(r,(function(r,t){var o=(a=t,a.replace(/\d/g,"")).toLowerCase();var a;if(function(r){return f(Y,r)}(o)&&(u=e.type,i=o,c=Y[u]+Y[i],Z.test(c)))if(rr(o)){Pr(r,ar(e,r,o,n),n)}else ur(e,r,o);var u,i,c}))}function Lr(r,e){var n=0;var t=r.numProperties+1;for(;++n<t&&!1!==e(r.property(n),n,r););return r}var Br={abort:function(r){if(!$.level)alert(r,"Abort");throw new Error(r)},checkLength:function(r,e,n){if(void 0===n)n=1;if(r.length<n)Br.abort(e)},emptyArray:function(r){var e={};var n=w(m(r,(function(r,n){if(r instanceof PropertyGroup){return{parentProperty:r.parentProperty,propertyIndex:r.propertyIndex}}else e[n]=r})),(function(r){return!!r}));m(n,(function(r){(0,r.parentProperty)(r.propertyIndex).remove()}));R(e,(function(r){return r.remove()}))}};var Ir={get_active_comp:function(){var r=app.project.activeItem;return r instanceof CompItem?r:Br.abort("请在时间轴上打开合成")},get_selected_comps:function(){var r=w(app.project.selection,(function(r){return r instanceof CompItem}));Br.checkLength(r,"请在项目面板中选择合成");return r},get_selected_layers:function(){var r=Ir.get_active_comp().selectedLayers;Br.checkLength(r,"请选择图层");return r},get_selected_properties:function(){var r=Ir.get_selected_layers();var e=[];V(r,(function(r){e=e.concat(r.selectedProperties)}));return e},add_layer:function(r){var e,n;if(void 0===r)r="Shape";return null===(n=(e=this.get_active_comp().layers)["add"+r])||void 0===n?void 0:n.call(e)},add_solid_layer:function(r){if(void 0===r)r=[.5,.5,.5,1];var e=Ir.add_layer();e.name="Solid";var n=e.property("ADBE Root Vectors Group");n.addProperty("ADBE Vector Shape - Rect").property("Size").setValue([e.width,e.height]);n.addProperty("ADBE Vector Graphic - Fill").property("Color").setValue(r);return e},add_adjustment_layer:function(){var r=Ir.add_solid_layer();r.name="Adjustment";r.label=5;r.adjustmentLayer=!0;return r},add_null_layer:function(){var r=Ir.add_layer();r.name="Null";r.label=1;r.transform.scale.expression="[100, 100]";r.transform.opacity.setValue(0);r.property("ADBE Root Vectors Group").addProperty("ADBE Vector Shape - Rect");return r},add_layer_from_group:function(r){var e=r.propertyGroup(2);if(!(e instanceof ShapeLayer))Br.abort("请选择 形状层 - 内容(Contents) 的子属性组");var n=e.duplicate();n.name=[e.name,r.name].join(" - ");var t=n.property("ADBE Root Vectors Group");var o=[];Lr(t,(function(e,n){n+1!=r.propertyIndex&&e&&o.push(e)}));Br.emptyArray(o);return n},add_layers_from_selected_groups:function(){var r=w(Ir.get_selected_properties(),(function(r){return r instanceof PropertyGroup&&!(r instanceof MaskPropertyGroup)}));Br.checkLength(r,"请选择属性组(除蒙版以外)");var e=m(r,(function(r){return Ir.add_layer_from_group(r),r}));Br.emptyArray(e)},unpack_comp:function(r){r.selected=!0;var e=r.containingComp,n=r.startTime;var t=r.source.layers;for(var o=1;o<=t.length;o++){t[o].copyToComp(e);e.layers[r.index-1].startTime+=n}r.selected=!1},unpack_selected_comps:function(){var r=w(Ir.get_selected_layers(),(function(r){r.selected=!1;return r instanceof AVLayer&&r.source instanceof CompItem}));Br.checkLength(r,"请选择合成图层");var e=m(r,(function(r,e){return Ir.unpack_comp(r),r.source}));Br.emptyArray(e)},unpack_layer:function(r){r.selected=!0;var e=r.property("ADBE Root Vectors Group");var n=[];Lr(e,(function(r){r instanceof PropertyGroup&&!(r instanceof MaskPropertyGroup)&&n.push(r)}));Br.checkLength(n,"".concat(r.name," 图层只有 ").concat(n.length," 个属性组"),2);m(n,Ir.add_layer_from_group);r.selected=!1},unpack_selected_layers:function(){var r=w(Ir.get_selected_layers(),(function(r){r.selected=!1;return r instanceof ShapeLayer}));Br.checkLength(r,"请选择形状图层");var e=m(r,(function(r){return Ir.unpack_layer(r),r}));Br.emptyArray(e)},render:function(){app.project.renderQueue.showWindow(!0);app.project.renderQueue.render()},render_active_comp:function(){Ir.render_comp(Ir.get_active_comp())},render_selected_comps:function(){m(Ir.get_selected_comps(),Ir.render_comp)},render_comp:function(r){var e=app.project.renderQueue.items.add(r);Ir.render_setting(e);e.render=!0},render_setting:function(r){if(!app.project.file)return alert("请先保存项目");r.outputModule(1).setSettings({"Output File Info":{"Base Path":app.project.file.fsName.replace(/\\[^\\]+$/,""),"Subfolder Path":"render","File Name":r.comp.name}})}};var Gr=function(r,e,n){var t=r.length;if(0!==t||void 0!==n){var o=void 0===n?r[0]:n;var a=void 0===n?0:-1;for(;++a<t;)o=e(o,r[a],a,r);return o}}([["UC",Ir.unpack_selected_comps],["UL",Ir.unpack_selected_layers],["AS",Ir.add_solid_layer],["AA",Ir.add_adjustment_layer],["AN",Ir.add_null_layer],["AG",Ir.add_layers_from_selected_groups],["R",Ir.render_selected_comps],["F",function(){var r=[["点","Point"],["3D点","3D Point"],["角度","Angle"],["滑块","Slider"],["颜色","Color"],["复选框","Checkbox"],["菜单","Menu"],["图层","Layer"]];var e={zh_CN:function(){m(r,(function(r){var e=r[0],n=r[1];return app.project.autoFixExpressions(n,e)}))},en_US:function(){m(r,(function(r){var e=r[0],n=r[1];return app.project.autoFixExpressions(e,n)}))}};if(f(e,app.isoLanguage))e[app.isoLanguage]()}]],(function(r,e,n){var t=e[0],o=e[1];r["button"+n]={style:{text:t,preferredSize:[30,30],onClick:function(){return function(r,e){app.beginUndoGroup(r);e();app.endUndoGroup()}(t,o)}}};return r}),{style:{orientation:"column",alignChildren:"center",margins:0,spacing:0}});K.context=this;K.parse(Gr)}).call(this);
